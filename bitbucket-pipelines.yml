# This is a sample build configuration for Java (Maven).
# Check our guides at https://confluence.atlassian.com/x/zd-5Mw for more examples.
# Only use spaces to indent your .yml configuration.
# -----
# You can specify a custom docker image from Docker Hub as your build environment.
image: maven:3.6.1

pipelines:
  branches:
    develop:
      - step:
          caches:
            - maven
          script:
            # build and push each submodule
            - mvn -B clean install
	    
            # define list of submodules separated with space (eg. "submodule-1" "submodule-2") 
            - declare -a SUBMODULES=("submodule1" "submodule2")
	    
            # put each submodule's artifact to bitbucket's downloads page. it uses generated app password generated by admin user.
            - for submodule in ${SUBMODULES[@]}; do
            	echo ----------------UPLOADING----------------;
                echo $submodule;
                echo -----------------------------------------;
                curl -X POST --user "${BB_AUTH_STRING}" "https://api.bitbucket.org/2.0/repositories/${BITBUCKET_REPO_OWNER}/${BITBUCKET_REPO_SLUG}/downloads" --form files=@"$(find . -name ${submodule}*.war)" -v;
             done;
